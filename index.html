<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/MTY_C_b_round2_512.png" />

    <!-- 반응형 뷰포트 (인앱/커스텀탭에서 텍스트 자동확대 억제 포함) -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />

    <!-- 라이트 모드 고정 -->
    <meta name="color-scheme" content="light" />
    <meta name="theme-color" content="#ffffff" />

    <style>
      :root { color-scheme: light; }

      html {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      html, body {
        background:#ffffff; color:#111;
        width:100%; max-width:100%;
        overflow-x:hidden; /* 가로 스크롤로 인한 붕괴 방지 */
      }

      img, svg, picture, video, canvas {
        max-width:100%; height:auto;
        filter:none !important; display:block;
      }

      .break-keep, body { word-break: keep-all; }
      * { box-sizing: border-box; }
    </style>

    <title>C&KInsight</title>

    <!-- 구글 폰트 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- ✅ KakaoTalk in-app → 브라우저 선택 창으로 열기 (도메인 자동 인식 + fallback 버튼) -->
    <script>
      (function () {
        var ua = navigator.userAgent || '';
        var isKakao   = /KAKAOTALK/i.test(ua);
        var isAndroid = /Android/i.test(ua);
        var isIOS     = /iPhone|iPad|iPod/i.test(ua);

        if (!isKakao) return; // 일반 브라우저는 아무 것도 안 함

        // 현재 페이지 주소 자동 사용 (Vercel 프리뷰/실도메인 모두 대응)
        var ORIGIN = location.origin;                       // ex) https://xxx.vercel.app 또는 https://cnkinsight.com
        var HOST   = location.host;                         // ex) xxx.vercel.app 또는 cnkinsight.com
        var PATH   = location.pathname + location.search;   // 경로 + 쿼리
        var SCHEME = location.protocol.replace(':','');     // ex) https

        function openExternal() {
          if (isAndroid) {
            // ✅ 브라우저 선택 창(chooser)으로 열기: Custom Tab 회피
            var intent =
              'intent://' + HOST + PATH +
              '#Intent;scheme=' + SCHEME +
              ';action=android.intent.action.VIEW' +
              ';category=android.intent.category.BROWSABLE' +
              ';end';
            location.href = intent;
          } else if (isIOS) {
            // iOS는 Safari로 열기
            location.href = ORIGIN + PATH;
          }
        }

        function attachBar() {
          if (document.getElementById('open-external-bar')) return;

          var bar = document.createElement('div');
          bar.id = 'open-external-bar';
          bar.style.cssText =
            'position:fixed;left:12px;right:12px;bottom:16px;z-index:2147483647;' +
            'background:#111;color:#fff;padding:12px 14px;border-radius:12px;' +
            'box-shadow:0 6px 20px rgba(0,0,0,.2);display:flex;align-items:center;justify-content:space-between;' +
            'gap:12px;font-size:14px;line-height:1.3;';
          bar.innerHTML =
            '<span>카카오 인앱에서는 레이아웃이 깨질 수 있어요.</span>' +
            '<a id="open-external-btn" href="#" style="background:#D08700;color:#fff;padding:8px 12px;border-radius:9999px;text-decoration:none;white-space:nowrap;">외부 브라우저로 열기</a>';
          document.body.appendChild(bar);

          document.getElementById('open-external-btn').addEventListener('click', function (e) {
            e.preventDefault();
            openExternal(); // 사용자 제스처 기반 재시도 → 성공률↑
          }, { passive:false });
        }

        function showFallbackBar() {
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', attachBar, { once: true });
          } else {
            attachBar(); // 이미 로드된 상태면 즉시 부착
          }
        }

        // 1) 자동 시도 (카톡 인앱에서 열리면 chooser로 외부 브라우저 선택)
        openExternal();

        // 2) 실패 시 fallback 배너 노출 (여전히 이 페이지에 있으면 실패로 간주)
        setTimeout(function () {
          if (document.visibilityState === 'visible') showFallbackBar();
        }, 700);

        // 3) 히스토리 복귀 등 특수 케이스 대비
        window.addEventListener('pageshow', function () {
          if (document.visibilityState === 'visible' && !document.getElementById('open-external-bar')) {
            showFallbackBar();
          }
        });
      })();
    </script>
  </head>

  <body class="bg-white text-gray-900">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
